<div class="collection-page">
    <div class="collection-container">
        <!-- Collection Header -->
        <div class="collection-header">
            <h1 class="collection-title">{{ collection.title }}</h1>
            {% if collection.description != blank %}
                <div class="collection-description">
                    {{ collection.description }}
                </div>
            {% endif %}
            <div class="collection-meta">
                <span class="product-count">{{ collection.products_count }} {% if collection.products_count == 1 %}product{% else %}products{% endif %}</span>
            </div>
        </div>

        <!-- Collection Filters & Sort -->
        <div class="collection-toolbar">
            {% if section.settings.enable_filtering %}
                <div class="collection-filters">
                    <button class="filter-toggle" onclick="toggleFilters()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="4" y1="21" x2="4" y2="14"></line>
                            <line x1="4" y1="10" x2="4" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12" y2="3"></line>
                            <line x1="20" y1="21" x2="20" y2="16"></line>
                            <line x1="20" y1="12" x2="20" y2="3"></line>
                            <line x1="1" y1="14" x2="7" y2="14"></line>
                            <line x1="9" y1="8" x2="15" y2="8"></line>
                            <line x1="17" y1="16" x2="23" y2="16"></line>
                        </svg>
                        Filter
                    </button>
                </div>
            {% endif %}

            {% if section.settings.enable_sorting %}
                <div class="collection-sort">
                    <label for="sort-by">Sort by:</label>
                    <select id="sort-by" onchange="sortCollection(this.value)">
                        <option value="manual">Featured</option>
                        <option value="best-selling">Best Selling</option>
                        <option value="title-ascending">A-Z</option>
                        <option value="title-descending">Z-A</option>
                        <option value="price-ascending">Price: Low to High</option>
                        <option value="price-descending">Price: High to Low</option>
                        <option value="created-ascending">Oldest</option>
                        <option value="created-descending">Newest</option>
                    </select>
                </div>
            {% endif %}
        </div>

        <!-- Filter Panel -->
        {% if section.settings.enable_filtering %}
            <div class="filter-panel" id="filter-panel">
                <div class="filter-section">
                    <h3>Price Range</h3>
                    <div class="price-filter">
                        <input type="range" id="price-range" min="0" max="1000" value="1000">
                        <div class="price-display">$0 - $<span id="price-value">1000</span></div>
                    </div>
                </div>
                
                {% if collection.all_tags.size > 0 %}
                    <div class="filter-section">
                        <h3>Tags</h3>
                        <div class="tag-filters">
                            {% for tag in collection.all_tags %}
                                <label class="tag-filter">
                                    <input type="checkbox" value="{{ tag | handle }}">
                                    <span class="checkmark"></span>
                                    {{ tag }}
                                </label>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>
        {% endif %}

        <!-- Product Grid -->
        <div class="products-grid">
            {% for product in collection.products %}
                <div class="product-card" data-price="{{ product.price | money_without_currency | remove: ',' }}" data-tags="{{ product.tags | join: ' ' | handle }}">
                    <div class="product-image-wrapper">
                        <a href="{{ product.url }}" class="product-link">
                            {% if product.featured_image %}
                                <img
                                    src="{{ product.featured_image | image_url: width: 400 }}"
                                    alt="{{ product.title }}"
                                    class="product-image"
                                    loading="lazy"
                                />
                                {% if product.images[1] %}
                                    <img
                                        src="{{ product.images[1] | image_url: width: 400 }}"
                                        alt="{{ product.title }}"
                                        class="product-image-hover"
                                        loading="lazy"
                                    />
                                {% endif %}
                            {% else %}
                                <div class="product-image-placeholder">
                                    <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21,15 16,10 5,21"></polyline>
                                    </svg>
                                </div>
                            {% endif %}
                        </a>
                        
                        {% if product.compare_at_price > product.price %}
                            <div class="product-badge">Sale</div>
                        {% endif %}
                        
                        {% unless product.available %}
                            <div class="product-badge sold-out">Sold Out</div>
                        {% endunless %}
                    </div>
                    
                    <div class="product-info">
                        {% if section.settings.show_vendor and product.vendor %}
                            <div class="product-vendor">{{ product.vendor }}</div>
                        {% endif %}
                        
                        <h3 class="product-title">
                            <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        
                        <div class="product-price-wrapper">
                            {% if product.compare_at_price > product.price %}
                                <span class="product-price--compare">{{ product.compare_at_price | money_with_currency }}</span>
                                <span class="product-price--sale">{{ product.price | money_with_currency }}</span>
                            {% else %}
                                <span class="product-price">{{ product.price | money_with_currency }}</span>
                            {% endif %}
                        </div>
                        
                        {% if section.settings.show_description and product.description %}
                            <div class="product-description">
                                {{ product.description | strip_html | truncate: 100 }}
                            </div>
                        {% endif %}
                        
                        <div class="product-actions">
                            {% if product.available %}
                                <a href="{{ product.url }}" class="quick-view-btn">Quick View</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="empty-collection">
                    <h3>No products found</h3>
                    <p>This collection is empty or no products match your filters.</p>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if paginate.pages > 1 %}
            <div class="pagination">
                {% if paginate.previous %}
                    <a href="{{ paginate.previous.url }}" class="pagination-btn">← Previous</a>
                {% endif %}
                
                <div class="pagination-pages">
                    {% for part in paginate.parts %}
                        {% if part.is_link %}
                            <a href="{{ part.url }}" class="pagination-page">{{ part.title }}</a>
                        {% else %}
                            <span class="pagination-page current">{{ part.title }}</span>
                        {% endif %}
                    {% endfor %}
                </div>
                
                {% if paginate.next %}
                    <a href="{{ paginate.next.url }}" class="pagination-btn">Next →</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<style>
    .collection-page {
        padding: 2rem 1rem;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background-color: #fafafa;
        min-height: 100vh;
    }

    .collection-container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .collection-header {
        text-align: center;
        margin-bottom: 3rem;
        background: white;
        padding: 3rem 2rem;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .collection-title {
        font-size: 3rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 1rem;
        line-height: 1.2;
    }

    .collection-description {
        font-size: 1.2rem;
        color: #666;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    .collection-meta {
        color: #999;
        font-size: 1rem;
    }

    .collection-toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .filter-toggle {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .filter-toggle:hover {
        background: #e9ecef;
    }

    .collection-sort {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .collection-sort label {
        font-weight: 600;
        color: #333;
    }

    .collection-sort select {
        padding: 0.75rem 1rem;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        background: white;
        font-size: 1rem;
    }

    .filter-panel {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        display: none;
    }

    .filter-panel.active {
        display: block;
    }

    .filter-section {
        margin-bottom: 2rem;
    }

    .filter-section h3 {
        margin-bottom: 1rem;
        color: #333;
        font-weight: 600;
    }

    .price-filter {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .price-display {
        font-weight: 600;
        color: #2e7d32;
    }

    .tag-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .tag-filter {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: #f8f9fa;
        border-radius: 20px;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .tag-filter:hover {
        background: #e9ecef;
    }

    .tag-filter input[type="checkbox"] {
        display: none;
    }

    .checkmark {
        width: 16px;
        height: 16px;
        border: 2px solid #ddd;
        border-radius: 3px;
        position: relative;
    }

    .tag-filter input[type="checkbox"]:checked + .checkmark {
        background: #000;
        border-color: #000;
    }

    .tag-filter input[type="checkbox"]:checked + .checkmark::after {
        content: "✓";
        position: absolute;
        top: -2px;
        left: 2px;
        color: white;
        font-size: 12px;
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .product-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    .product-image-wrapper {
        position: relative;
        overflow: hidden;
        aspect-ratio: 1;
    }

    .product-image,
    .product-image-hover {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.3s ease;
    }

    .product-image-hover {
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0;
    }

    .product-card:hover .product-image-hover {
        opacity: 1;
    }

    .product-image-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
        color: #ccc;
    }

    .product-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: #e53e3e;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .product-badge.sold-out {
        background: #999;
    }

    .product-info {
        padding: 1.5rem;
    }

    .product-vendor {
        color: #666;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
    }

    .product-title {
        margin-bottom: 0.75rem;
    }

    .product-title a {
        color: #333;
        text-decoration: none;
        font-size: 1.1rem;
        font-weight: 600;
        line-height: 1.3;
        transition: color 0.2s ease;
    }

    .product-title a:hover {
        color: #000;
    }

    .product-price-wrapper {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .product-price {
        font-size: 1.25rem;
        font-weight: 600;
        color: #2e7d32;
    }

    .product-price--compare {
        font-size: 1rem;
        color: #999;
        text-decoration: line-through;
    }

    .product-price--sale {
        font-size: 1.25rem;
        font-weight: 600;
        color: #e53e3e;
    }

    .product-description {
        color: #666;
        font-size: 0.9rem;
        line-height: 1.4;
        margin-bottom: 1rem;
    }

    .product-actions {
        display: flex;
        gap: 1rem;
    }

    .quick-view-btn {
        background: #000;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.2s ease;
    }

    .quick-view-btn:hover {
        background: #333;
        transform: translateY(-2px);
    }

    .empty-collection {
        grid-column: 1 / -1;
        text-align: center;
        padding: 4rem 2rem;
        color: #666;
    }

    .empty-collection h3 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: #333;
    }

    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        padding: 2rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .pagination-btn,
    .pagination-page {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        text-decoration: none;
        color: #333;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    .pagination-btn:hover,
    .pagination-page:hover {
        background: #f8f9fa;
    }

    .pagination-page.current {
        background: #000;
        color: white;
    }

    .pagination-pages {
        display: flex;
        gap: 0.5rem;
    }

    @media (max-width: 768px) {
        .collection-title {
            font-size: 2rem;
        }
        
        .collection-toolbar {
            flex-direction: column;
            gap: 1rem;
        }
        
        .products-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .collection-header {
            padding: 2rem 1rem;
        }
        
        .pagination {
            flex-direction: column;
            gap: 1rem;
        }
        
        .pagination-pages {
            flex-wrap: wrap;
            justify-content: center;
        }
    }
</style>

<script>
    function toggleFilters() {
        const filterPanel = document.getElementById('filter-panel');
        filterPanel.classList.toggle('active');
    }

    function sortCollection(sortValue) {
        const url = new URL(window.location);
        url.searchParams.set('sort_by', sortValue);
        window.location.href = url.toString();
    }

    // Price filter functionality
    document.addEventListener('DOMContentLoaded', function() {
        const priceRange = document.getElementById('price-range');
        const priceValue = document.getElementById('price-value');
        
        if (priceRange && priceValue) {
            priceRange.addEventListener('input', function() {
                priceValue.textContent = this.value;
                filterByPrice(this.value);
            });
        }
    });

    function filterByPrice(maxPrice) {
        const productCards = document.querySelectorAll('.product-card');
        productCards.forEach(card => {
            const price = parseFloat(card.dataset.price);
            if (price <= maxPrice) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    // Tag filter functionality
    document.addEventListener('change', function(e) {
        if (e.target.type === 'checkbox' && e.target.closest('.tag-filter')) {
            filterByTags();
        }
    });

    function filterByTags() {
        const checkedTags = Array.from(document.querySelectorAll('.tag-filter input[type="checkbox"]:checked'))
            .map(checkbox => checkbox.value);
        
        const productCards = document.querySelectorAll('.product-card');
        
        productCards.forEach(card => {
            const productTags = card.dataset.tags.split(' ');
            const hasMatchingTag = checkedTags.length === 0 || 
                checkedTags.some(tag => productTags.includes(tag));
            
            card.style.display = hasMatchingTag ? 'block' : 'none';
        });
    }
</script>

{% schema %}
{
  "name": "Collection",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Collection Page Settings"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show product vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show product description",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable product filtering",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable product sorting",
      "default": true
    },
    {
      "type": "select",
      "id": "products_per_row",
      "label": "Products per row",
      "options": [
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        },
        {
          "value": "5",
          "label": "5"
        }
      ],
      "default": "4"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 50,
      "step": 2,
      "default": 16
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#2e7d32"
    },
    {
      "type": "color",
      "id": "sale_color",
      "label": "Sale price color",
      "default": "#e53e3e"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button color",
      "default": "#000000"
    }
  ]
}
{% endschema %}
